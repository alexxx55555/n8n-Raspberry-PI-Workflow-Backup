{
  "updatedAt": "2026-02-26T21:19:51.074Z",
  "createdAt": "2025-09-25T17:15:01.091Z",
  "id": "HqSNUkMsk5Zj1gYp",
  "name": "User AD/JC Offboarding",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f54ab6de-2566-4063-b57a-aa7fd93f51fb",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -4016,
        544
      ],
      "id": "f3fa1084-1518-44ad-bf54-cc276ee56a50",
      "name": "Webhook",
      "webhookId": "f54ab6de-2566-4063-b57a-aa7fd93f51fb"
    },
    {
      "parameters": {
        "jsCode": "const ALLOWED_CHANNEL_IDS = new Set(['C09GN391SQ6']);\nconst payload = $json.body ?? $json;\nconst channelId = payload.channel_id || payload.channel?.id || null;\nlet authorized = false;\nlet errorMessage = '';\nif (channelId && ALLOWED_CHANNEL_IDS.has(channelId)) {\n  authorized = true;\n} else {\n  errorMessage = 'üö´ This command can only be used in #disable-ad-user';\n}\nreturn { ...$json, authorized, errorMessage };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3616,
        544
      ],
      "id": "b0df9864-3d79-49d1-bc10-77dae6f44c23",
      "name": "Authorization Check1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{$json.authorized}}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              },
              "id": "090f0236-251d-489f-a118-e5df589c55a2"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -3424,
        544
      ],
      "id": "04950403-7397-48fb-9faa-acf3eebe3291",
      "name": "IF Authorized1"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.errorMessage}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3216,
        752
      ],
      "id": "788a0866-405f-4ce9-bdd7-80a1eb7e342c",
      "name": "Access Denied Response1"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "‚öôÔ∏è Offboarding user... please wait",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -3216,
        528
      ],
      "id": "3bd1579c-eca4-4110-a42d-46f42a7b0ceb",
      "name": "Processing Response1"
    },
    {
      "parameters": {
        "jsCode": "const payload = $json.body ?? $json;\nconst text = (payload.text ?? '').trim();\nconst parts = text.split(/\\s+/);\n\nif (parts.length < 2) {\n  throw new Error('Invalid format. Use: /disable-user AD username OR /disable-user JC username');\n}\n\nconst system = parts[0].toUpperCase();\nconst username = parts[1].replace(/^@/, '');\n\nif (!['AD', 'JC'].includes(system)) {\n  throw new Error('Invalid system. Use AD or JC');\n}\n\nif (!username) {\n  throw new Error('No username provided.');\n}\n\nreturn { body: { username, system } };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3024,
        528
      ],
      "id": "7e951ad6-959a-4c49-82eb-05b3f81f2e55",
      "name": "Normalize Username Input1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.body.system}}",
                    "rightValue": "AD",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AD Only"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.body.system}}",
                    "rightValue": "JC",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "JC Only"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2816,
        528
      ],
      "id": "82da0131-f59d-44fd-b5f0-076d0bd06a55",
      "name": "System Switch1"
    },
    {
      "parameters": {
        "command": "=powershell.exe -NoProfile -ExecutionPolicy Bypass -File \"C:\\Scripts\\Disable-ADUser-From-n8n.ps1\" -Username \"{{$json[\"body\"][\"username\"]}}\"",
        "cwd": "="
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        -2624,
        448
      ],
      "id": "a70b2df4-c9f9-4ac2-8134-94551ae46aab",
      "name": "Disable AD User1",
      "credentials": {
        "sshPassword": {
          "id": "umWU43lA8b3R4GcA",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "command": "=powershell.exe -NoProfile -ExecutionPolicy Bypass -File \"C:\\Scripts\\Disable-JCUser-From-n8n.ps1\" -Username \"{{$json[\"body\"][\"username\"]}}\"",
        "cwd": "="
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        -2624,
        656
      ],
      "id": "baa1ec1f-e07c-43ca-b5a7-12053960e849",
      "name": "Disable JC User1",
      "credentials": {
        "sshPassword": {
          "id": "umWU43lA8b3R4GcA",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "console.log('AD Output:', JSON.stringify($json, null, 2));\n\nif (!$json.stdout) {\n  throw new Error('PowerShell Error: ' + ($json.stderr || 'No stdout received'));\n}\n\nconst stdout = $json.stdout.trim();\nif (stdout === '') {\n  throw new Error('PowerShell returned empty output. Stderr: ' + ($json.stderr || 'none'));\n}\n\ntry {\n  const result = JSON.parse(stdout);\n  return { ...result, System: 'AD' };\n} catch (e) {\n  throw new Error('Failed to parse JSON. Output: ' + stdout + '. Error: ' + e.message);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2416,
        448
      ],
      "id": "c3b912fe-0e19-493f-8026-b8a94b96f78b",
      "name": "Parse AD Output1"
    },
    {
      "parameters": {
        "jsCode": "console.log('JC Output:', JSON.stringify($json, null, 2));\n\nif (!$json.stdout || $json.stdout.trim() === '') {\n  throw new Error('JC PowerShell returned empty stdout. Stderr: ' + ($json.stderr || 'none'));\n}\n\nconst stdout = $json.stdout.trim();\n\ntry {\n  const result = JSON.parse(stdout);\n  return { ...result, System: 'JC' };\n} catch (e) {\n  throw new Error('Failed to parse JC JSON. Output: ' + stdout + '. Error: ' + e.message);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2416,
        656
      ],
      "id": "6291ea4c-cdb8-4389-8819-9c8911665131",
      "name": "Parse JC Output1"
    },
    {
      "parameters": {
        "jsCode": "const data = $json;\nconst isAD = data.System === 'AD';\n\nif (isAD) {\n  return {\n    Username:      data.Username,\n    FullName:      data.FullName || '',\n    System:        'Active Directory',\n    Status:        data.Status,\n    Message:       data.Message,\n    GroupsRemoved: data.GroupsRemoved || [],\n    MovedToOU:     data.MovedToOU || '',\n    Email:         '',\n    JCUserId:      ''\n  };\n} else {\n  return {\n    Username:      data.Username,\n    FullName:      data.FullName || '',\n    System:        'JumpCloud',\n    Status:        data.Status,\n    Message:       data.Message,\n    GroupsRemoved: data.GroupsRemoved || [],\n    MovedToOU:     '',\n    Email:         data.Email || '',\n    JCUserId:      data.JCUserId || ''\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2224,
        544
      ],
      "id": "f630b51d-6a66-44c0-806d-a94214151b26",
      "name": "Format Results1"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09GN391SQ6",
          "mode": "list",
          "cachedResultName": "disable-ad-user"
        },
        "text": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '‚ùå Offboarding Failed\\n\\nüë§ Username: ' + $json.Username + '\\nüñ•Ô∏è System: ' + $json.System + '\\nüí¨ ' + $json.Message\n    : 'üî¥ User Offboarded ‚Äî ' + $json.System +\n      '\\n\\nüë§ Username: ' + $json.Username +\n      '\\nüÜî Full Name: ' + $json.FullName +\n      '\\nüìå Status: ' + $json.Status +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0 ? '\\nüóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '): ' + $json.GroupsRemoved.join(', ') : '\\nüóëÔ∏è Groups Removed: None') +\n      ($json.MovedToOU ? '\\nüìÇ Moved To: ' + $json.MovedToOU : '') +\n      ($json.Email ? '\\nüìß Email: ' + $json.Email : '') +\n      '\\nüí¨ ' + $json.Message\n}}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -1984,
        304
      ],
      "id": "b4f084b0-5a65-4cbf-8577-22df7b3ec867",
      "name": "Slack Notification1",
      "webhookId": "cfa0b125-8a9f-4e07-a59f-16512e2b8be8",
      "credentials": {
        "slackApi": {
          "id": "obEYVo8oQOJ22JqX",
          "name": "AD Admin Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "426570413",
        "text": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '‚ùå Offboarding Failed\\n\\nüë§ Username: ' + $json.Username + '\\nüñ•Ô∏è System: ' + $json.System + '\\nüí¨ ' + $json.Message\n    : 'üî¥ User Offboarded ‚Äî ' + $json.System +\n      '\\n\\nüë§ Username: ' + $json.Username +\n      '\\nüÜî Full Name: ' + $json.FullName +\n      '\\nüìå Status: ' + $json.Status +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0 ? '\\nüóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '): ' + $json.GroupsRemoved.join(', ') : '\\nüóëÔ∏è Groups Removed: None') +\n      ($json.MovedToOU ? '\\nüìÇ Moved To: ' + $json.MovedToOU : '') +\n      ($json.Email ? '\\nüìß Email: ' + $json.Email : '') +\n      '\\nüí¨ ' + $json.Message\n}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1984,
        512
      ],
      "id": "065340c1-124c-4951-8fa5-5cf90c07c84c",
      "name": "Telegram Notification1",
      "webhookId": "e27d090f-78da-49c3-bce3-c71f50ee342d",
      "credentials": {
        "telegramApi": {
          "id": "x7W5pZqq5q5bGRzU",
          "name": "Disable AD User"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "vinokura@alex-it.net",
        "subject": "=User Offboarded ‚Äî {{$json.System}} ‚Äî {{$json.Username}}",
        "message": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '<h3 style=\"color:#d32f2f;\">‚ùå Offboarding Failed</h3>' +\n      '<p><b>üë§ Username:</b> ' + $json.Username + '</p>' +\n      '<p><b>üñ•Ô∏è System:</b> ' + $json.System + '</p>' +\n      '<p><b>üí¨ Message:</b> ' + $json.Message + '</p>'\n    : '<h2 style=\"color:#b71c1c;\">üî¥ User Offboarded ‚Äî ' + $json.System + '</h2>' +\n      '<p><b>üë§ Username:</b> ' + $json.Username + '</p>' +\n      '<p><b>üÜî Full Name:</b> ' + $json.FullName + '</p>' +\n      '<p><b>üìå Status:</b> ' + $json.Status + '</p>' +\n      '<p><b>üí¨ Message:</b> ' + $json.Message + '</p>' +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0\n        ? '<p><b>üóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '):</b> ' + $json.GroupsRemoved.join(', ') + '</p>'\n        : '<p><b>üóëÔ∏è Groups Removed:</b> None</p>'\n      ) +\n      ($json.MovedToOU ? '<p><b>üìÇ Moved To OU:</b> ' + $json.MovedToOU + '</p>' : '') +\n      ($json.Email ? '<p><b>üìß Email:</b> ' + $json.Email + '</p>' : '') +\n      ($json.JCUserId ? '<p><b>üîë JC User ID:</b> ' + $json.JCUserId + '</p>' : '') +\n      '<hr><p style=\"font-size:0.85em;color:gray;\">Automated by n8n offboarding workflow</p>'\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -1968,
        704
      ],
      "id": "8b216d0b-e816-4013-9962-ab50ef532929",
      "name": "Gmail Notification1",
      "webhookId": "4a313315-5329-4a6f-8d51-35fbab5624c7",
      "credentials": {
        "gmailOAuth2": {
          "id": "C5742Grqr9Rpnxid",
          "name": "Gmail account"
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Authorization Check1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Authorization Check1": {
      "main": [
        [
          {
            "node": "IF Authorized1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Authorized1": {
      "main": [
        [
          {
            "node": "Processing Response1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Access Denied Response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processing Response1": {
      "main": [
        [
          {
            "node": "Normalize Username Input1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Username Input1": {
      "main": [
        [
          {
            "node": "System Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "System Switch1": {
      "main": [
        [
          {
            "node": "Disable AD User1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Disable JC User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disable AD User1": {
      "main": [
        [
          {
            "node": "Parse AD Output1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disable JC User1": {
      "main": [
        [
          {
            "node": "Parse JC Output1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AD Output1": {
      "main": [
        [
          {
            "node": "Format Results1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse JC Output1": {
      "main": [
        [
          {
            "node": "Format Results1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Results1": {
      "main": [
        [
          {
            "node": "Slack Notification1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Telegram Notification1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gmail Notification1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "bf8f15ca-cded-41f0-8446-538c5558e4d4",
  "activeVersionId": "bf8f15ca-cded-41f0-8446-538c5558e4d4",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-10-31T09:14:00.842Z",
      "createdAt": "2025-10-31T09:14:00.842Z",
      "role": "workflow:owner",
      "workflowId": "HqSNUkMsk5Zj1gYp",
      "projectId": "pWTWmuHnmIHw48U9"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-02-26T21:19:52.000Z",
    "createdAt": "2026-02-26T21:19:51.075Z",
    "versionId": "bf8f15ca-cded-41f0-8446-538c5558e4d4",
    "workflowId": "HqSNUkMsk5Zj1gYp",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "f54ab6de-2566-4063-b57a-aa7fd93f51fb",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -4016,
          544
        ],
        "id": "f3fa1084-1518-44ad-bf54-cc276ee56a50",
        "name": "Webhook",
        "webhookId": "f54ab6de-2566-4063-b57a-aa7fd93f51fb"
      },
      {
        "parameters": {
          "jsCode": "const ALLOWED_CHANNEL_IDS = new Set(['C09GN391SQ6']);\nconst payload = $json.body ?? $json;\nconst channelId = payload.channel_id || payload.channel?.id || null;\nlet authorized = false;\nlet errorMessage = '';\nif (channelId && ALLOWED_CHANNEL_IDS.has(channelId)) {\n  authorized = true;\n} else {\n  errorMessage = 'üö´ This command can only be used in #disable-ad-user';\n}\nreturn { ...$json, authorized, errorMessage };"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -3616,
          544
        ],
        "id": "b0df9864-3d79-49d1-bc10-77dae6f44c23",
        "name": "Authorization Check1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 1
            },
            "conditions": [
              {
                "leftValue": "={{$json.authorized}}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                },
                "id": "090f0236-251d-489f-a118-e5df589c55a2"
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -3424,
          544
        ],
        "id": "04950403-7397-48fb-9faa-acf3eebe3291",
        "name": "IF Authorized1"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "={{$json.errorMessage}}",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          -3216,
          752
        ],
        "id": "788a0866-405f-4ce9-bdd7-80a1eb7e342c",
        "name": "Access Denied Response1"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "‚öôÔ∏è Offboarding user... please wait",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          -3216,
          528
        ],
        "id": "3bd1579c-eca4-4110-a42d-46f42a7b0ceb",
        "name": "Processing Response1"
      },
      {
        "parameters": {
          "jsCode": "const payload = $json.body ?? $json;\nconst text = (payload.text ?? '').trim();\nconst parts = text.split(/\\s+/);\n\nif (parts.length < 2) {\n  throw new Error('Invalid format. Use: /disable-user AD username OR /disable-user JC username');\n}\n\nconst system = parts[0].toUpperCase();\nconst username = parts[1].replace(/^@/, '');\n\nif (!['AD', 'JC'].includes(system)) {\n  throw new Error('Invalid system. Use AD or JC');\n}\n\nif (!username) {\n  throw new Error('No username provided.');\n}\n\nreturn { body: { username, system } };"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -3024,
          528
        ],
        "id": "7e951ad6-959a-4c49-82eb-05b3f81f2e55",
        "name": "Normalize Username Input1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "leftValue": "={{$json.body.system}}",
                      "rightValue": "AD",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "AD Only"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "leftValue": "={{$json.body.system}}",
                      "rightValue": "JC",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "JC Only"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -2816,
          528
        ],
        "id": "82da0131-f59d-44fd-b5f0-076d0bd06a55",
        "name": "System Switch1"
      },
      {
        "parameters": {
          "command": "=powershell.exe -NoProfile -ExecutionPolicy Bypass -File \"C:\\Scripts\\Disable-ADUser-From-n8n.ps1\" -Username \"{{$json[\"body\"][\"username\"]}}\"",
          "cwd": "="
        },
        "type": "n8n-nodes-base.ssh",
        "typeVersion": 1,
        "position": [
          -2624,
          448
        ],
        "id": "a70b2df4-c9f9-4ac2-8134-94551ae46aab",
        "name": "Disable AD User1",
        "credentials": {
          "sshPassword": {
            "id": "umWU43lA8b3R4GcA",
            "name": "SSH Password account"
          }
        }
      },
      {
        "parameters": {
          "command": "=powershell.exe -NoProfile -ExecutionPolicy Bypass -File \"C:\\Scripts\\Disable-JCUser-From-n8n.ps1\" -Username \"{{$json[\"body\"][\"username\"]}}\"",
          "cwd": "="
        },
        "type": "n8n-nodes-base.ssh",
        "typeVersion": 1,
        "position": [
          -2624,
          656
        ],
        "id": "baa1ec1f-e07c-43ca-b5a7-12053960e849",
        "name": "Disable JC User1",
        "credentials": {
          "sshPassword": {
            "id": "umWU43lA8b3R4GcA",
            "name": "SSH Password account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "console.log('AD Output:', JSON.stringify($json, null, 2));\n\nif (!$json.stdout) {\n  throw new Error('PowerShell Error: ' + ($json.stderr || 'No stdout received'));\n}\n\nconst stdout = $json.stdout.trim();\nif (stdout === '') {\n  throw new Error('PowerShell returned empty output. Stderr: ' + ($json.stderr || 'none'));\n}\n\ntry {\n  const result = JSON.parse(stdout);\n  return { ...result, System: 'AD' };\n} catch (e) {\n  throw new Error('Failed to parse JSON. Output: ' + stdout + '. Error: ' + e.message);\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -2416,
          448
        ],
        "id": "c3b912fe-0e19-493f-8026-b8a94b96f78b",
        "name": "Parse AD Output1"
      },
      {
        "parameters": {
          "jsCode": "console.log('JC Output:', JSON.stringify($json, null, 2));\n\nif (!$json.stdout || $json.stdout.trim() === '') {\n  throw new Error('JC PowerShell returned empty stdout. Stderr: ' + ($json.stderr || 'none'));\n}\n\nconst stdout = $json.stdout.trim();\n\ntry {\n  const result = JSON.parse(stdout);\n  return { ...result, System: 'JC' };\n} catch (e) {\n  throw new Error('Failed to parse JC JSON. Output: ' + stdout + '. Error: ' + e.message);\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -2416,
          656
        ],
        "id": "6291ea4c-cdb8-4389-8819-9c8911665131",
        "name": "Parse JC Output1"
      },
      {
        "parameters": {
          "jsCode": "const data = $json;\nconst isAD = data.System === 'AD';\n\nif (isAD) {\n  return {\n    Username:      data.Username,\n    FullName:      data.FullName || '',\n    System:        'Active Directory',\n    Status:        data.Status,\n    Message:       data.Message,\n    GroupsRemoved: data.GroupsRemoved || [],\n    MovedToOU:     data.MovedToOU || '',\n    Email:         '',\n    JCUserId:      ''\n  };\n} else {\n  return {\n    Username:      data.Username,\n    FullName:      data.FullName || '',\n    System:        'JumpCloud',\n    Status:        data.Status,\n    Message:       data.Message,\n    GroupsRemoved: data.GroupsRemoved || [],\n    MovedToOU:     '',\n    Email:         data.Email || '',\n    JCUserId:      data.JCUserId || ''\n  };\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -2224,
          544
        ],
        "id": "f630b51d-6a66-44c0-806d-a94214151b26",
        "name": "Format Results1"
      },
      {
        "parameters": {
          "select": "channel",
          "channelId": {
            "__rl": true,
            "value": "C09GN391SQ6",
            "mode": "list",
            "cachedResultName": "disable-ad-user"
          },
          "text": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '‚ùå Offboarding Failed\\n\\nüë§ Username: ' + $json.Username + '\\nüñ•Ô∏è System: ' + $json.System + '\\nüí¨ ' + $json.Message\n    : 'üî¥ User Offboarded ‚Äî ' + $json.System +\n      '\\n\\nüë§ Username: ' + $json.Username +\n      '\\nüÜî Full Name: ' + $json.FullName +\n      '\\nüìå Status: ' + $json.Status +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0 ? '\\nüóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '): ' + $json.GroupsRemoved.join(', ') : '\\nüóëÔ∏è Groups Removed: None') +\n      ($json.MovedToOU ? '\\nüìÇ Moved To: ' + $json.MovedToOU : '') +\n      ($json.Email ? '\\nüìß Email: ' + $json.Email : '') +\n      '\\nüí¨ ' + $json.Message\n}}",
          "otherOptions": {}
        },
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.3,
        "position": [
          -1984,
          304
        ],
        "id": "b4f084b0-5a65-4cbf-8577-22df7b3ec867",
        "name": "Slack Notification1",
        "webhookId": "cfa0b125-8a9f-4e07-a59f-16512e2b8be8",
        "credentials": {
          "slackApi": {
            "id": "obEYVo8oQOJ22JqX",
            "name": "AD Admin Bot"
          }
        }
      },
      {
        "parameters": {
          "chatId": "426570413",
          "text": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '‚ùå Offboarding Failed\\n\\nüë§ Username: ' + $json.Username + '\\nüñ•Ô∏è System: ' + $json.System + '\\nüí¨ ' + $json.Message\n    : 'üî¥ User Offboarded ‚Äî ' + $json.System +\n      '\\n\\nüë§ Username: ' + $json.Username +\n      '\\nüÜî Full Name: ' + $json.FullName +\n      '\\nüìå Status: ' + $json.Status +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0 ? '\\nüóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '): ' + $json.GroupsRemoved.join(', ') : '\\nüóëÔ∏è Groups Removed: None') +\n      ($json.MovedToOU ? '\\nüìÇ Moved To: ' + $json.MovedToOU : '') +\n      ($json.Email ? '\\nüìß Email: ' + $json.Email : '') +\n      '\\nüí¨ ' + $json.Message\n}}",
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          -1984,
          512
        ],
        "id": "065340c1-124c-4951-8fa5-5cf90c07c84c",
        "name": "Telegram Notification1",
        "webhookId": "e27d090f-78da-49c3-bce3-c71f50ee342d",
        "credentials": {
          "telegramApi": {
            "id": "x7W5pZqq5q5bGRzU",
            "name": "Disable AD User"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "vinokura@alex-it.net",
          "subject": "=User Offboarded ‚Äî {{$json.System}} ‚Äî {{$json.Username}}",
          "message": "={{\n  $json.Status === 'Not Found' || $json.Status === 'Error'\n    ? '<h3 style=\"color:#d32f2f;\">‚ùå Offboarding Failed</h3>' +\n      '<p><b>üë§ Username:</b> ' + $json.Username + '</p>' +\n      '<p><b>üñ•Ô∏è System:</b> ' + $json.System + '</p>' +\n      '<p><b>üí¨ Message:</b> ' + $json.Message + '</p>'\n    : '<h2 style=\"color:#b71c1c;\">üî¥ User Offboarded ‚Äî ' + $json.System + '</h2>' +\n      '<p><b>üë§ Username:</b> ' + $json.Username + '</p>' +\n      '<p><b>üÜî Full Name:</b> ' + $json.FullName + '</p>' +\n      '<p><b>üìå Status:</b> ' + $json.Status + '</p>' +\n      '<p><b>üí¨ Message:</b> ' + $json.Message + '</p>' +\n      ($json.GroupsRemoved && $json.GroupsRemoved.length > 0\n        ? '<p><b>üóëÔ∏è Groups Removed (' + $json.GroupsRemoved.length + '):</b> ' + $json.GroupsRemoved.join(', ') + '</p>'\n        : '<p><b>üóëÔ∏è Groups Removed:</b> None</p>'\n      ) +\n      ($json.MovedToOU ? '<p><b>üìÇ Moved To OU:</b> ' + $json.MovedToOU + '</p>' : '') +\n      ($json.Email ? '<p><b>üìß Email:</b> ' + $json.Email + '</p>' : '') +\n      ($json.JCUserId ? '<p><b>üîë JC User ID:</b> ' + $json.JCUserId + '</p>' : '') +\n      '<hr><p style=\"font-size:0.85em;color:gray;\">Automated by n8n offboarding workflow</p>'\n}}",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -1968,
          704
        ],
        "id": "8b216d0b-e816-4013-9962-ab50ef532929",
        "name": "Gmail Notification1",
        "webhookId": "4a313315-5329-4a6f-8d51-35fbab5624c7",
        "credentials": {
          "gmailOAuth2": {
            "id": "C5742Grqr9Rpnxid",
            "name": "Gmail account"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Authorization Check1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Authorization Check1": {
        "main": [
          [
            {
              "node": "IF Authorized1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF Authorized1": {
        "main": [
          [
            {
              "node": "Processing Response1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Access Denied Response1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Processing Response1": {
        "main": [
          [
            {
              "node": "Normalize Username Input1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Username Input1": {
        "main": [
          [
            {
              "node": "System Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "System Switch1": {
        "main": [
          [
            {
              "node": "Disable AD User1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Disable JC User1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Disable AD User1": {
        "main": [
          [
            {
              "node": "Parse AD Output1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Disable JC User1": {
        "main": [
          [
            {
              "node": "Parse JC Output1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse AD Output1": {
        "main": [
          [
            {
              "node": "Format Results1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse JC Output1": {
        "main": [
          [
            {
              "node": "Format Results1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Results1": {
        "main": [
          [
            {
              "node": "Slack Notification1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Telegram Notification1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gmail Notification1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Alex Vinokur",
    "name": "Version bf8f15ca",
    "description": "",
    "autosaved": false
  },
  "tags": []
}