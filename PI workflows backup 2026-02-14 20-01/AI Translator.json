{
  "updatedAt": "2026-02-07T18:02:23.266Z",
  "createdAt": "2026-01-23T18:38:21.921Z",
  "id": "ezzdhUM8oSPHv1c6FLrie",
  "name": "AI Translator",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "slack-interactive",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "d4cebd4a-7b72-429a-a4e7-104ea5c15d53",
      "name": "ğŸ”˜ Button Click Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -144,
        -592
      ],
      "webhookId": "slack-interactive"
    },
    {
      "parameters": {
        "jsCode": "// Parse Slack interactive payload\nconst body = $input.first().json.body;\nconst payload = JSON.parse(body.payload);\n\n// Case 1: Triggered via the \"Translate this\" menu shortcut\nif (payload.type === 'message_action') {\n  return {\n    json: {\n      text: payload.message.text,\n      target_language: 'en', // Default to English for shortcuts\n      source_language: 'auto',\n      response_url: payload.response_url,\n      user_id: payload.user.id,\n      user_name: payload.user.name,\n      trigger_type: 'shortcut'\n    }\n  };\n}\n\n// Case 2: Triggered via a button click (your current logic)\nconst value = payload.actions[0].value;\nconst parts = value.split('|');\n\nreturn {\n  json: {\n    target_language: parts[0],\n    source_language: parts[1],\n    text: parts.slice(2).join('|'),\n    response_url: payload.response_url,\n    user_id: payload.user.id,\n    user_name: payload.user.name,\n    trigger_type: 'button'\n  }\n};"
      },
      "id": "7520e4e3-476a-423f-9540-8b8faf1a14ed",
      "name": "ğŸ“‹ Parse Button Click",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        -592
      ]
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200
        }
      },
      "id": "44c119b4-ec2c-4786-988d-5c12d221bdc7",
      "name": "âš¡ ACK Button",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        336,
        -592
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.response_url }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "replace_original",
              "value": "true"
            },
            {
              "name": "text",
              "value": "=â³ Translating to {{ $json.target_language }}..."
            }
          ]
        },
        "options": {}
      },
      "id": "100b0b06-5b68-4640-b971-a78e541dcece",
      "name": "â³ Show Translating",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        576,
        -592
      ]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json.output;\nconst inputData = $node[\"ğŸ“‹ Parse Button Click\"].json;\n\n// Updated Flag Map: en is now US flag\nconst flags = {\n  en: \"ğŸ‡ºğŸ‡¸\", fr: \"ğŸ‡«ğŸ‡·\", es: \"ğŸ‡ªğŸ‡¸\", de: \"ğŸ‡©ğŸ‡ª\",\n  he: \"ğŸ‡®ğŸ‡±\", ar: \"ğŸ‡¸ğŸ‡¦\", ja: \"ğŸ‡¯ğŸ‡µ\", zh: \"ğŸ‡¨ğŸ‡³\",\n  ru: \"ğŸ‡·ğŸ‡º\", it: \"ğŸ‡®ğŸ‡¹\", pt: \"ğŸ‡µğŸ‡¹\", ko: \"ğŸ‡°ğŸ‡·\"\n};\n\nconst langNames = {\n  en: \"English\", fr: \"French\", es: \"Spanish\", de: \"German\",\n  he: \"Hebrew\", ar: \"Arabic\", ja: \"Japanese\", zh: \"Chinese\",\n  ru: \"Russian\", it: \"Italian\", pt: \"Portuguese\", ko: \"Korean\"\n};\n\nconst rtlLangs = [\"he\", \"ar\"];\n\ntry {\n  const start = response.indexOf('{');\n  const end = response.lastIndexOf('}') + 1;\n  if (start === -1 || end === 0) throw new Error(\"No JSON found\");\n\n  const parsed = JSON.parse(response.slice(start, end));\n  let translation = parsed.translation || \"(Translation missing)\";\n\n  if (rtlLangs.includes(inputData.target_language)) {\n    translation = `\\u202B${translation}\\u202C`;\n  }\n\n  return {\n    json: {\n      detected_language_name: langNames[inputData.source_language] || inputData.source_language,\n      target_language_name: langNames[inputData.target_language] || inputData.target_language,\n      source_flag: flags[inputData.source_language] || \"ğŸŒ\",\n      target_flag: flags[inputData.target_language] || \"ğŸŒ\",\n      flag: flags[inputData.target_language] || \"ğŸŒ\", // Backward compatibility for existing blocks\n      original_text: inputData.text,\n      formatted_translation: translation,\n      response_url: inputData.response_url\n    }\n  };\n} catch (error) {\n  return { json: { formatted_translation: \"âŒ Error: \" + error.message, source_flag: \"âš ï¸\", target_flag: \"âš ï¸\" } };\n}"
      },
      "id": "0d76294e-e751-408b-87ce-33e7f73eb8fe",
      "name": "âœ… Parse Translation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1152,
        -592
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.response_url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replace_original\": true,\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": \"ğŸŒ Translation Complete\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ğŸ“ Original ({{ $json.source_flag }} {{ $json.detected_language_name }}):*\\n```{{ $json.original_text }}```\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*{{ $json.target_flag }} {{ $json.target_language_name }} Translation:*\\n```{{ $json.formatted_translation }}```\"\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "id": "87b8212e-5066-4d43-bb41-6ede5e2d635b",
      "name": "âœ… Send Translation Result",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1360,
        -592
      ]
    },
    {
      "parameters": {
        "model": "openai/gpt-5-nano",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        896,
        -336
      ],
      "id": "1244af55-5a15-4df5-83a5-37d48ef07975",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "hGAnvpSAhWRbFktq",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5-nano",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        688,
        -832
      ],
      "id": "053a874c-c8db-4bea-9946-fdb8c72547a4",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "hGAnvpSAhWRbFktq",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "google/gemma-3-27b",
          "mode": "list",
          "cachedResultName": "google/gemma-3-27b"
        },
        "options": {
          "frequencyPenalty": 0.3,
          "maxTokens": 1000,
          "presencePenalty": 0.1,
          "temperature": 0.1,
          "timeout": 60000,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        464,
        -832
      ],
      "id": "4c37f41d-a057-4052-9f92-60f3b7a2e652",
      "name": "ğŸ¤– LLM (Detect)",
      "credentials": {
        "openAiApi": {
          "id": "WJsCuec8UzGRGVIc",
          "name": "Macbook ProM1 Pro"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "translate",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a82220a2-2529-4eb0-8548-63e084dcee8f",
      "name": "ğŸ¯ Slack Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -144,
        -1040
      ],
      "webhookId": "translate-webhook"
    },
    {
      "parameters": {
        "jsCode": "// Extract data from Slack slash command\nconst body = $input.first().json.body;\nconst text = body.text ? body.text.trim() : 'No text provided';\n\nreturn {\n  json: {\n    text: text,\n    user_id: body.user_id || 'unknown',\n    user_name: body.user_name || 'unknown',\n    channel_id: body.channel_id || 'unknown',\n    response_url: body.response_url || null\n  }\n};"
      },
      "id": "01d857f8-0fb2-4538-83b0-aaa7bb05c8c0",
      "name": "ğŸ“‹ Parse Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        -1040
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e8549515-b2a0-4eab-9fb4-4086f2515cd1",
      "name": "âš¡ Immediate Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        336,
        -1040
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Detect the language of this text and return ONLY a JSON object:\n\n{\n  \"language_code\": \"<ISO 639-1 code>\",\n  \"language_name\": \"<Full language name>\",\n  \"confidence\": \"high|medium|low\"\n}\n\nText: {{ $json.text }}",
        "needsFallback": true,
        "options": {
          "systemMessage": "You are a language detection AI. Always output valid JSON only."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        576,
        -1040
      ],
      "id": "234b3630-11d4-4f68-a3cb-02569d446fc5",
      "name": "ğŸ” Detect Language"
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json.output;\nconst inputData = $node[\"ğŸ“‹ Parse Input\"].json;\n\ntry {\n  const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n  const parsed = JSON.parse(jsonMatch[0]);\n  \n  return {\n    json: {\n      text: inputData.text,\n      detected_language: parsed.language_code,\n      detected_language_name: parsed.language_name,\n      response_url: inputData.response_url,\n      user_id: inputData.user_id,\n      user_name: inputData.user_name\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      text: inputData.text,\n      detected_language: 'en',\n      detected_language_name: 'English',\n      response_url: inputData.response_url,\n      user_id: inputData.user_id,\n      user_name: inputData.user_name\n    }\n  };\n}"
      },
      "id": "a5eecb62-2105-49d4-b2a8-d739507a6711",
      "name": "Parse Detection",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        928,
        -1040
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.response_url }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "replace_original",
              "value": "true"
            },
            {
              "name": "text",
              "value": "=ğŸŒ *Translate Text*\n\nğŸ“ Original ({{ $json.detected_language_name }}):\n`{{ $json.text }}`\n\nğŸ‘‡ *Choose a language to translate to:*"
            },
            {
              "name": "blocks",
              "value": "=[\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": \"ğŸŒ *Translate Text*\\n\\nğŸ“ Original ({{ $json.detected_language_name }}): `{{ $json.text }}`\\n\\nğŸ‘‡ *Choose a language to translate to:*\"\n    }\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡ºğŸ‡¸ English\", \"emoji\": true },\n        \"value\": \"en|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_en\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡«ğŸ‡· French\", \"emoji\": true },\n        \"value\": \"fr|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_fr\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡ªğŸ‡¸ Spanish\", \"emoji\": true },\n        \"value\": \"es|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_es\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡©ğŸ‡ª German\", \"emoji\": true },\n        \"value\": \"de|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_de\"\n      }\n    ]\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select_2\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡®ğŸ‡± Hebrew\", \"emoji\": true },\n        \"value\": \"he|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_he\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¸ğŸ‡¦ Arabic\", \"emoji\": true },\n        \"value\": \"ar|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ar\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¯ğŸ‡µ Japanese\", \"emoji\": true },\n        \"value\": \"ja|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ja\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¨ğŸ‡³ Chinese\", \"emoji\": true },\n        \"value\": \"zh|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_zh\"\n      }\n    ]\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select_3\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡·ğŸ‡º Russian\", \"emoji\": true },\n        \"value\": \"ru|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ru\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡®ğŸ‡¹ Italian\", \"emoji\": true },\n        \"value\": \"it|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_it\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡µğŸ‡¹ Portuguese\", \"emoji\": true },\n        \"value\": \"pt|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_pt\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡°ğŸ‡· Korean\", \"emoji\": true },\n        \"value\": \"ko|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ko\"\n      }\n    ]\n  }\n]"
            }
          ]
        },
        "options": {}
      },
      "id": "473c2777-b776-4c58-9c1e-3d19117c7943",
      "name": "ğŸ›ï¸ Show Language Buttons",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1184,
        -1040
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=TASK: Translate the provided text.\nTARGET LANGUAGE: {{ $node[\"ğŸ“‹ Parse Button Click\"].json.target_language }}\nSOURCE LANGUAGE: {{ $node[\"ğŸ“‹ Parse Button Click\"].json.source_language }}\n\nINPUT TEXT:\n{{ $node[\"ğŸ“‹ Parse Button Click\"].json.text }}\n\nOUTPUT FORMAT (Return ONLY raw JSON):\n{\n  \"detected_language\": \"{{ $node[\"ğŸ“‹ Parse Button Click\"].json.source_language }}\",\n  \"target_language\": \"{{ $node[\"ğŸ“‹ Parse Button Click\"].json.target_language }}\",\n  \"translation\": \"...\"\n}\n\nCRITICAL: \n1. Do not include markdown formatting like ```json.\n2. Only translate the \"translation\" value.\n3. Do not add any conversational text.",
        "needsFallback": true,
        "options": {
          "systemMessage": "You are a translation API. Output only valid JSON. Never add extra text."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        816,
        -592
      ],
      "id": "bd2b1429-7d56-4ef8-b18f-aa23f640f296",
      "name": "ğŸŒ AI Translator"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "qwen/qwen3-coder-30b",
          "mode": "list",
          "cachedResultName": "qwen/qwen3-coder-30b"
        },
        "options": {
          "frequencyPenalty": 0.3,
          "maxTokens": 500,
          "presencePenalty": 0.1,
          "temperature": 0,
          "timeout": 120000,
          "topP": 0.8
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        656,
        -336
      ],
      "id": "8091f806-c86e-4e37-97cf-cbb2c785bc3e",
      "name": "ğŸ¤– LLM (Translate",
      "credentials": {
        "openAiApi": {
          "id": "WJsCuec8UzGRGVIc",
          "name": "Macbook ProM1 Pro"
        }
      }
    }
  ],
  "connections": {
    "ğŸ”˜ Button Click Webhook": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Parse Button Click",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Parse Button Click": {
      "main": [
        [
          {
            "node": "âš¡ ACK Button",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš¡ ACK Button": {
      "main": [
        [
          {
            "node": "â³ Show Translating",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â³ Show Translating": {
      "main": [
        [
          {
            "node": "ğŸŒ AI Translator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Parse Translation": {
      "main": [
        [
          {
            "node": "âœ… Send Translation Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸŒ AI Translator",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸ” Detect Language",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ¤– LLM (Detect)": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸ” Detect Language",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Slack Webhook": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Parse Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Parse Input": {
      "main": [
        [
          {
            "node": "âš¡ Immediate Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš¡ Immediate Response": {
      "main": [
        [
          {
            "node": "ğŸ” Detect Language",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Detect Language": {
      "main": [
        [
          {
            "node": "Parse Detection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Detection": {
      "main": [
        [
          {
            "node": "ğŸ›ï¸ Show Language Buttons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ AI Translator": {
      "main": [
        [
          {
            "node": "âœ… Parse Translation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– LLM (Translate": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸŒ AI Translator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "b69f0074-822c-4d0f-8f6f-d5950874e168",
  "activeVersionId": "b69f0074-822c-4d0f-8f6f-d5950874e168",
  "triggerCount": 2,
  "shared": [
    {
      "updatedAt": "2026-01-23T18:38:21.926Z",
      "createdAt": "2026-01-23T18:38:21.926Z",
      "role": "workflow:owner",
      "workflowId": "ezzdhUM8oSPHv1c6FLrie",
      "projectId": "pWTWmuHnmIHw48U9"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-02-07T18:02:24.000Z",
    "createdAt": "2026-02-07T18:02:23.268Z",
    "versionId": "b69f0074-822c-4d0f-8f6f-d5950874e168",
    "workflowId": "ezzdhUM8oSPHv1c6FLrie",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "slack-interactive",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "d4cebd4a-7b72-429a-a4e7-104ea5c15d53",
        "name": "ğŸ”˜ Button Click Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -144,
          -592
        ],
        "webhookId": "slack-interactive"
      },
      {
        "parameters": {
          "jsCode": "// Parse Slack interactive payload\nconst body = $input.first().json.body;\nconst payload = JSON.parse(body.payload);\n\n// Case 1: Triggered via the \"Translate this\" menu shortcut\nif (payload.type === 'message_action') {\n  return {\n    json: {\n      text: payload.message.text,\n      target_language: 'en', // Default to English for shortcuts\n      source_language: 'auto',\n      response_url: payload.response_url,\n      user_id: payload.user.id,\n      user_name: payload.user.name,\n      trigger_type: 'shortcut'\n    }\n  };\n}\n\n// Case 2: Triggered via a button click (your current logic)\nconst value = payload.actions[0].value;\nconst parts = value.split('|');\n\nreturn {\n  json: {\n    target_language: parts[0],\n    source_language: parts[1],\n    text: parts.slice(2).join('|'),\n    response_url: payload.response_url,\n    user_id: payload.user.id,\n    user_name: payload.user.name,\n    trigger_type: 'button'\n  }\n};"
        },
        "id": "7520e4e3-476a-423f-9540-8b8faf1a14ed",
        "name": "ğŸ“‹ Parse Button Click",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          96,
          -592
        ]
      },
      {
        "parameters": {
          "options": {
            "responseCode": 200
          }
        },
        "id": "44c119b4-ec2c-4786-988d-5c12d221bdc7",
        "name": "âš¡ ACK Button",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          336,
          -592
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $json.response_url }}",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "replace_original",
                "value": "true"
              },
              {
                "name": "text",
                "value": "=â³ Translating to {{ $json.target_language }}..."
              }
            ]
          },
          "options": {}
        },
        "id": "100b0b06-5b68-4640-b971-a78e541dcece",
        "name": "â³ Show Translating",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          576,
          -592
        ]
      },
      {
        "parameters": {
          "jsCode": "const response = $input.first().json.output;\nconst inputData = $node[\"ğŸ“‹ Parse Button Click\"].json;\n\n// Updated Flag Map: en is now US flag\nconst flags = {\n  en: \"ğŸ‡ºğŸ‡¸\", fr: \"ğŸ‡«ğŸ‡·\", es: \"ğŸ‡ªğŸ‡¸\", de: \"ğŸ‡©ğŸ‡ª\",\n  he: \"ğŸ‡®ğŸ‡±\", ar: \"ğŸ‡¸ğŸ‡¦\", ja: \"ğŸ‡¯ğŸ‡µ\", zh: \"ğŸ‡¨ğŸ‡³\",\n  ru: \"ğŸ‡·ğŸ‡º\", it: \"ğŸ‡®ğŸ‡¹\", pt: \"ğŸ‡µğŸ‡¹\", ko: \"ğŸ‡°ğŸ‡·\"\n};\n\nconst langNames = {\n  en: \"English\", fr: \"French\", es: \"Spanish\", de: \"German\",\n  he: \"Hebrew\", ar: \"Arabic\", ja: \"Japanese\", zh: \"Chinese\",\n  ru: \"Russian\", it: \"Italian\", pt: \"Portuguese\", ko: \"Korean\"\n};\n\nconst rtlLangs = [\"he\", \"ar\"];\n\ntry {\n  const start = response.indexOf('{');\n  const end = response.lastIndexOf('}') + 1;\n  if (start === -1 || end === 0) throw new Error(\"No JSON found\");\n\n  const parsed = JSON.parse(response.slice(start, end));\n  let translation = parsed.translation || \"(Translation missing)\";\n\n  if (rtlLangs.includes(inputData.target_language)) {\n    translation = `\\u202B${translation}\\u202C`;\n  }\n\n  return {\n    json: {\n      detected_language_name: langNames[inputData.source_language] || inputData.source_language,\n      target_language_name: langNames[inputData.target_language] || inputData.target_language,\n      source_flag: flags[inputData.source_language] || \"ğŸŒ\",\n      target_flag: flags[inputData.target_language] || \"ğŸŒ\",\n      flag: flags[inputData.target_language] || \"ğŸŒ\", // Backward compatibility for existing blocks\n      original_text: inputData.text,\n      formatted_translation: translation,\n      response_url: inputData.response_url\n    }\n  };\n} catch (error) {\n  return { json: { formatted_translation: \"âŒ Error: \" + error.message, source_flag: \"âš ï¸\", target_flag: \"âš ï¸\" } };\n}"
        },
        "id": "0d76294e-e751-408b-87ce-33e7f73eb8fe",
        "name": "âœ… Parse Translation",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1152,
          -592
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $json.response_url }}",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"replace_original\": true,\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": \"ğŸŒ Translation Complete\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ğŸ“ Original ({{ $json.source_flag }} {{ $json.detected_language_name }}):*\\n```{{ $json.original_text }}```\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*{{ $json.target_flag }} {{ $json.target_language_name }} Translation:*\\n```{{ $json.formatted_translation }}```\"\n      }\n    }\n  ]\n}",
          "options": {}
        },
        "id": "87b8212e-5066-4d43-bb41-6ede5e2d635b",
        "name": "âœ… Send Translation Result",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1360,
          -592
        ]
      },
      {
        "parameters": {
          "model": "openai/gpt-5-nano",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          896,
          -336
        ],
        "id": "1244af55-5a15-4df5-83a5-37d48ef07975",
        "name": "OpenRouter Chat Model",
        "credentials": {
          "openRouterApi": {
            "id": "hGAnvpSAhWRbFktq",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "model": "openai/gpt-5-nano",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          688,
          -832
        ],
        "id": "053a874c-c8db-4bea-9946-fdb8c72547a4",
        "name": "OpenRouter Chat Model1",
        "credentials": {
          "openRouterApi": {
            "id": "hGAnvpSAhWRbFktq",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "google/gemma-3-27b",
            "mode": "list",
            "cachedResultName": "google/gemma-3-27b"
          },
          "options": {
            "frequencyPenalty": 0.3,
            "maxTokens": 1000,
            "presencePenalty": 0.1,
            "temperature": 0.1,
            "timeout": 60000,
            "topP": 0.9
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          464,
          -832
        ],
        "id": "4c37f41d-a057-4052-9f92-60f3b7a2e652",
        "name": "ğŸ¤– LLM (Detect)",
        "credentials": {
          "openAiApi": {
            "id": "WJsCuec8UzGRGVIc",
            "name": "Macbook ProM1 Pro"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "translate",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "a82220a2-2529-4eb0-8548-63e084dcee8f",
        "name": "ğŸ¯ Slack Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -144,
          -1040
        ],
        "webhookId": "translate-webhook"
      },
      {
        "parameters": {
          "jsCode": "// Extract data from Slack slash command\nconst body = $input.first().json.body;\nconst text = body.text ? body.text.trim() : 'No text provided';\n\nreturn {\n  json: {\n    text: text,\n    user_id: body.user_id || 'unknown',\n    user_name: body.user_name || 'unknown',\n    channel_id: body.channel_id || 'unknown',\n    response_url: body.response_url || null\n  }\n};"
        },
        "id": "01d857f8-0fb2-4538-83b0-aaa7bb05c8c0",
        "name": "ğŸ“‹ Parse Input",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          96,
          -1040
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "e8549515-b2a0-4eab-9fb4-4086f2515cd1",
        "name": "âš¡ Immediate Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          336,
          -1040
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Detect the language of this text and return ONLY a JSON object:\n\n{\n  \"language_code\": \"<ISO 639-1 code>\",\n  \"language_name\": \"<Full language name>\",\n  \"confidence\": \"high|medium|low\"\n}\n\nText: {{ $json.text }}",
          "needsFallback": true,
          "options": {
            "systemMessage": "You are a language detection AI. Always output valid JSON only."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          576,
          -1040
        ],
        "id": "234b3630-11d4-4f68-a3cb-02569d446fc5",
        "name": "ğŸ” Detect Language"
      },
      {
        "parameters": {
          "jsCode": "const response = $input.first().json.output;\nconst inputData = $node[\"ğŸ“‹ Parse Input\"].json;\n\ntry {\n  const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n  const parsed = JSON.parse(jsonMatch[0]);\n  \n  return {\n    json: {\n      text: inputData.text,\n      detected_language: parsed.language_code,\n      detected_language_name: parsed.language_name,\n      response_url: inputData.response_url,\n      user_id: inputData.user_id,\n      user_name: inputData.user_name\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      text: inputData.text,\n      detected_language: 'en',\n      detected_language_name: 'English',\n      response_url: inputData.response_url,\n      user_id: inputData.user_id,\n      user_name: inputData.user_name\n    }\n  };\n}"
        },
        "id": "a5eecb62-2105-49d4-b2a8-d739507a6711",
        "name": "Parse Detection",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          928,
          -1040
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $json.response_url }}",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "replace_original",
                "value": "true"
              },
              {
                "name": "text",
                "value": "=ğŸŒ *Translate Text*\n\nğŸ“ Original ({{ $json.detected_language_name }}):\n`{{ $json.text }}`\n\nğŸ‘‡ *Choose a language to translate to:*"
              },
              {
                "name": "blocks",
                "value": "=[\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": \"ğŸŒ *Translate Text*\\n\\nğŸ“ Original ({{ $json.detected_language_name }}): `{{ $json.text }}`\\n\\nğŸ‘‡ *Choose a language to translate to:*\"\n    }\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡ºğŸ‡¸ English\", \"emoji\": true },\n        \"value\": \"en|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_en\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡«ğŸ‡· French\", \"emoji\": true },\n        \"value\": \"fr|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_fr\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡ªğŸ‡¸ Spanish\", \"emoji\": true },\n        \"value\": \"es|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_es\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡©ğŸ‡ª German\", \"emoji\": true },\n        \"value\": \"de|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_de\"\n      }\n    ]\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select_2\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡®ğŸ‡± Hebrew\", \"emoji\": true },\n        \"value\": \"he|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_he\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¸ğŸ‡¦ Arabic\", \"emoji\": true },\n        \"value\": \"ar|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ar\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¯ğŸ‡µ Japanese\", \"emoji\": true },\n        \"value\": \"ja|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ja\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡¨ğŸ‡³ Chinese\", \"emoji\": true },\n        \"value\": \"zh|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_zh\"\n      }\n    ]\n  },\n  {\n    \"type\": \"actions\",\n    \"block_id\": \"lang_select_3\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡·ğŸ‡º Russian\", \"emoji\": true },\n        \"value\": \"ru|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ru\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡®ğŸ‡¹ Italian\", \"emoji\": true },\n        \"value\": \"it|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_it\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡µğŸ‡¹ Portuguese\", \"emoji\": true },\n        \"value\": \"pt|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_pt\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ‡°ğŸ‡· Korean\", \"emoji\": true },\n        \"value\": \"ko|{{ $json.detected_language }}|{{ $json.text }}\",\n        \"action_id\": \"translate_ko\"\n      }\n    ]\n  }\n]"
              }
            ]
          },
          "options": {}
        },
        "id": "473c2777-b776-4c58-9c1e-3d19117c7943",
        "name": "ğŸ›ï¸ Show Language Buttons",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1184,
          -1040
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=TASK: Translate the provided text.\nTARGET LANGUAGE: {{ $node[\"ğŸ“‹ Parse Button Click\"].json.target_language }}\nSOURCE LANGUAGE: {{ $node[\"ğŸ“‹ Parse Button Click\"].json.source_language }}\n\nINPUT TEXT:\n{{ $node[\"ğŸ“‹ Parse Button Click\"].json.text }}\n\nOUTPUT FORMAT (Return ONLY raw JSON):\n{\n  \"detected_language\": \"{{ $node[\"ğŸ“‹ Parse Button Click\"].json.source_language }}\",\n  \"target_language\": \"{{ $node[\"ğŸ“‹ Parse Button Click\"].json.target_language }}\",\n  \"translation\": \"...\"\n}\n\nCRITICAL: \n1. Do not include markdown formatting like ```json.\n2. Only translate the \"translation\" value.\n3. Do not add any conversational text.",
          "needsFallback": true,
          "options": {
            "systemMessage": "You are a translation API. Output only valid JSON. Never add extra text."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          816,
          -592
        ],
        "id": "bd2b1429-7d56-4ef8-b18f-aa23f640f296",
        "name": "ğŸŒ AI Translator"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "qwen/qwen3-coder-30b",
            "mode": "list",
            "cachedResultName": "qwen/qwen3-coder-30b"
          },
          "options": {
            "frequencyPenalty": 0.3,
            "maxTokens": 500,
            "presencePenalty": 0.1,
            "temperature": 0,
            "timeout": 120000,
            "topP": 0.8
          }
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          656,
          -336
        ],
        "id": "8091f806-c86e-4e37-97cf-cbb2c785bc3e",
        "name": "ğŸ¤– LLM (Translate",
        "credentials": {
          "openAiApi": {
            "id": "WJsCuec8UzGRGVIc",
            "name": "Macbook ProM1 Pro"
          }
        }
      }
    ],
    "connections": {
      "ğŸ”˜ Button Click Webhook": {
        "main": [
          [
            {
              "node": "ğŸ“‹ Parse Button Click",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ğŸ“‹ Parse Button Click": {
        "main": [
          [
            {
              "node": "âš¡ ACK Button",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "âš¡ ACK Button": {
        "main": [
          [
            {
              "node": "â³ Show Translating",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "â³ Show Translating": {
        "main": [
          [
            {
              "node": "ğŸŒ AI Translator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "âœ… Parse Translation": {
        "main": [
          [
            {
              "node": "âœ… Send Translation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "ğŸŒ AI Translator",
              "type": "ai_languageModel",
              "index": 1
            }
          ]
        ]
      },
      "OpenRouter Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "ğŸ” Detect Language",
              "type": "ai_languageModel",
              "index": 1
            }
          ]
        ]
      },
      "ğŸ¤– LLM (Detect)": {
        "ai_languageModel": [
          [
            {
              "node": "ğŸ” Detect Language",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "ğŸ¯ Slack Webhook": {
        "main": [
          [
            {
              "node": "ğŸ“‹ Parse Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ğŸ“‹ Parse Input": {
        "main": [
          [
            {
              "node": "âš¡ Immediate Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "âš¡ Immediate Response": {
        "main": [
          [
            {
              "node": "ğŸ” Detect Language",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ğŸ” Detect Language": {
        "main": [
          [
            {
              "node": "Parse Detection",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Detection": {
        "main": [
          [
            {
              "node": "ğŸ›ï¸ Show Language Buttons",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ğŸŒ AI Translator": {
        "main": [
          [
            {
              "node": "âœ… Parse Translation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ğŸ¤– LLM (Translate": {
        "ai_languageModel": [
          [
            {
              "node": "ğŸŒ AI Translator",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Alex Vinokur",
    "name": "Version b69f0074",
    "description": "",
    "autosaved": true
  },
  "tags": []
}