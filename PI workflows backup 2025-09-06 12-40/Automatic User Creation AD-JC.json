{
  "createdAt": "2025-09-02T14:13:13.473Z",
  "updatedAt": "2025-09-05T19:21:18.000Z",
  "id": "vb6sSMl5XrlcvUae",
  "name": "Automatic User Creation AD/JC",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "command": "=powershell.exe -NoProfile -Command \"& { C:\\Scripts\\Create-JCUser-From-n8n.ps1 -FirstName '{{$json[\"body\"][\"firstname\"]}}' -LastName '{{$json[\"body\"][\"lastname\"]}}' -EmployeeNumber '{{$json[\"body\"][\"employeenumber\"]}}' -JobTitle '{{$json[\"body\"][\"jobtitle\"]}}' -Department '{{$json[\"body\"][\"department\"]}}' -ManagerSam '{{$json[\"body\"][\"managersam\"]}}' -OfficePhone '{{$json[\"body\"][\"officephone\"]}}' -OfficeLocation '{{$json[\"body\"][\"officelocation\"]}}' }\"",
        "cwd": "="
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        336,
        368
      ],
      "id": "4649fb8f-700e-4eb9-9782-6463045b12e1",
      "name": "Create New JC User",
      "credentials": {
        "sshPassword": {
          "id": "79KNHZGwd8w288i9",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7dd6a3f5-aa13-4fdc-88f8-a9798fbf925d",
                    "leftValue": "={{$json.subject || $json.headers?.subject?.replace(/^Subject:\\s*/i,'').trim() || ''}}",
                    "rightValue": "JC",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3367d402-3127-4cf0-b3de-69d8cdc8cf90",
                    "leftValue": "={{$json.subject || $json.headers?.subject?.replace(/^Subject:\\s*/i,'').trim() || ''}}",
                    "rightValue": "AD",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -528,
        384
      ],
      "id": "623d9d9d-f43a-4eac-938d-6280fc827fc9",
      "name": "Switch"
    },
    {
      "parameters": {
        "command": "=powershell.exe -NoProfile -Command \"& { C:\\Scripts\\Create-ADUser-From-n8n.ps1 -FirstName '{{$json[\"body\"][\"firstname\"]}}' -LastName '{{$json[\"body\"][\"lastname\"]}}' -EmployeeNumber '{{$json[\"body\"][\"employeenumber\"]}}' -JobTitle '{{$json[\"body\"][\"jobtitle\"]}}' -Department '{{$json[\"body\"][\"department\"]}}' -ManagerSam '{{$json[\"body\"][\"managersam\"]}}' -OfficePhone '{{$json[\"body\"][\"officephone\"]}}' -OfficeLocation '{{$json[\"body\"][\"officelocation\"]}}' -SourceUsername '{{$json[\"body\"][\"sourceusername\"]}}' }\"",
        "cwd": "="
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        496,
        1056
      ],
      "id": "3bbe77b5-167d-4bc7-b1cc-d4478080f857",
      "name": "Create New AD User",
      "credentials": {
        "sshPassword": {
          "id": "79KNHZGwd8w288i9",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Gmail Trigger').item.json.from?.value?.map(v => v.address).join(', ') }}",
        "subject": "=Re: {{$('Gmail Trigger').item.json.subject}} - Processing Started",
        "message": "=<h2 style=\"color:blue;\">ðŸ“§ User Creation Request Received</h2>\n\n<p>Thank you for your user creation request. We have received your email and are processing the following information:</p>\n\n<ul>\n<li><b>First Name:</b> {{$json[\"body\"][\"firstname\"]}}</li>\n<li><b>Last Name:</b> {{$json[\"body\"][\"lastname\"]}}</li>\n<li><b>Employee Number:</b> {{$json[\"body\"][\"employeenumber\"]}}</li>\n<li><b>Job Title:</b> {{$json[\"body\"][\"jobtitle\"]}}</li>\n<li><b>Department:</b> {{$json[\"body\"][\"department\"]}}</li>\n<li><b>Manager SAM:</b> {{$json[\"body\"][\"managersam\"]}}</li>\n<li><b>Office Phone:</b> {{$json[\"body\"][\"officephone\"] || 'Not provided'}}</li>\n<li><b>Office Location:</b> {{$json[\"body\"][\"officelocation\"] || 'Not provided'}}</li>\n</ul>\n\n<p style=\"color:green;\"><b>Status:</b> Processing...</p>\n<p>You will receive another notification once the user account has been created successfully.</p>\n\n<hr>\n<small>This is an automated message from Alex IT Systems.</small>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -16,
        608
      ],
      "id": "84050103-df7e-4eb4-bdb3-0689e1949426",
      "name": "Send Acknowledgment AD",
      "webhookId": "799b1b4d-00fd-4a0c-890c-9991db9a7c75",
      "credentials": {
        "gmailOAuth2": {
          "id": "Ajg1dWYNadbKjzNX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Gmail Trigger').item.json.from?.value?.map(v => v.address).join(', ') }}",
        "subject": "=Re: {{$('Gmail Trigger').item.json.subject}} - Processing Started",
        "message": "=<h2 style=\"color:blue;\">ðŸ“§ User Creation Request Received</h2>\n\n<p>Thank you for your user creation request. We have received your email and are processing the following information:</p>\n\n<ul>\n<li><b>First Name:</b> {{$json[\"body\"][\"firstname\"]}}</li>\n<li><b>Last Name:</b> {{$json[\"body\"][\"lastname\"]}}</li>\n<li><b>Employee Number:</b> {{$json[\"body\"][\"employeenumber\"]}}</li>\n<li><b>Job Title:</b> {{$json[\"body\"][\"jobtitle\"]}}</li>\n<li><b>Department:</b> {{$json[\"body\"][\"department\"]}}</li>\n<li><b>Manager SAM:</b> {{$json[\"body\"][\"managersam\"]}}</li>\n<li><b>Office Phone:</b> {{$json[\"body\"][\"officephone\"] || 'Not provided'}}</li>\n<li><b>Office Location:</b> {{$json[\"body\"][\"officelocation\"] || 'Not provided'}}</li>\n</ul>\n\n<p style=\"color:green;\"><b>Status:</b> Processing...</p>\n<p>You will receive another notification once the user account has been created successfully.</p>\n\n<hr>\n<small>This is an automated message from Alex IT Systems.</small>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "5bd74fd0-6f0a-4024-9cd3-bcebd00f201b",
      "name": "Send Acknowledgment JC",
      "webhookId": "799b1b4d-00fd-4a0c-890c-9991db9a7c75",
      "credentials": {
        "gmailOAuth2": {
          "id": "Ajg1dWYNadbKjzNX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {},
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -864,
        384
      ],
      "id": "895819df-a8b6-414a-aeff-22aeca645fcd",
      "name": "Gmail Trigger",
      "credentials": {
        "gmailOAuth2": {
          "id": "Ajg1dWYNadbKjzNX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ----- 1) Get the email body from this payload shape -----\nfunction htmlToText(html) {\n  if (!html) return '';\n  // Normalize line breaks before stripping tags\n  html = html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|li|tr|h\\d)>/gi, '\\n')\n    .replace(/&nbsp;/gi, ' ');\n  // Strip tags\n  const text = html.replace(/<[^>]+>/g, ' ');\n  // Collapse whitespace\n  return text.replace(/\\r?\\n/g, '\\n').replace(/[ \\t]+\\n/g, '\\n').replace(/[ \\t]{2,}/g, ' ').trim();\n}\n\nlet emailBody =\n  ($json.text && String($json.text)) ||\n  htmlToText($json.html) ||\n  htmlToText($json.textAsHtml) ||\n  ($json.snippet && String($json.snippet)) ||\n  '';\n\n// If body still empty, try base64-encoded Gmail payload (rare here but safe)\nif (!emailBody && $json.payload && $json.payload.body && $json.payload.body.data) {\n  try {\n    const buff = Buffer.from($json.payload.body.data, 'base64');\n    emailBody = buff.toString('utf8');\n  } catch (_) {}\n}\n\n// Safety: normalize whitespace for robust regex capture\nconst flat = (emailBody || '').replace(/\\r/g, '').replace(/[ \\t]+/g, ' ').trim();\n\n// ----- 2) Robust field capture (works for single-line or multiline) -----\nconst LABELS = [\n  'First Name','Last Name','Employee Number','Job Title',\n  'Department','Manager SAM','Manager','Office Phone','Phone',\n  'Office Location','Location'\n];\n\nfunction esc(s){ return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); }\n\nfunction captureAfter(label, src) {\n  const labelEsc = esc(label);\n  const next = LABELS.filter(l => l !== label).map(esc);\n  const lookahead = next.length ? `(?=\\\\s*(?:${next.join('|')})\\\\s*:|$)` : '$';\n  // Accept either single-line or multiline values\n  const re = new RegExp(`${labelEsc}\\\\s*:\\\\s*([\\\\s\\\\S]*?)\\\\s*${lookahead}`, 'i');\n  const m = src.match(re);\n  return m ? m[1].trim() : '';\n}\n\nconst userData = {\n  firstname:      captureAfter('First Name', flat),\n  lastname:       captureAfter('Last Name', flat),\n  employeenumber: captureAfter('Employee Number', flat),\n  jobtitle:       captureAfter('Job Title', flat),\n  department:     captureAfter('Department', flat),\n  managersam:     captureAfter('Manager SAM', flat) || captureAfter('Manager', flat),\n  officephone:    captureAfter('Office Phone', flat) || captureAfter('Phone', flat),\n  officelocation: captureAfter('Office Location', flat) || captureAfter('Location', flat),\n};\n\n// ----- 3) Validate required fields -----\nconst required = ['firstname','lastname','employeenumber','jobtitle','department','managersam'];\nconst missing = required.filter(f => !userData[f] || userData[f].trim() === '');\nif (missing.length) {\n  throw new Error(`Missing required fields: ${missing.join(', ')}. Parsed body was empty or labels didn't match exactly.`);\n}\n\n// ----- 4) Subject/From/MessageId from this payload shape -----\nconst subj =\n  $json.subject ||\n  ($json.headers && typeof $json.headers.subject === 'string'\n    ? $json.headers.subject.replace(/^Subject:\\s*/i,'').trim()\n    : '');\n\nconst fromText =\n  ($json.from && $json.from.text) ||\n  ($json.headers && typeof $json.headers.from === 'string'\n    ? $json.headers.from.replace(/^From:\\s*/i,'').trim()\n    : '');\n\nconst msgId =\n  $json.messageId ||\n  ($json.headers && typeof $json.headers['message-id'] === 'string'\n    ? $json.headers['message-id'].replace(/^Message-Id:\\s*/i,'').trim()\n    : '');\n\n// ----- 5) Return in your expected shape -----\nreturn {\n  body: userData,\n  originalEmail: {\n    subject: subj,\n    from: fromText,\n    messageId: msgId,\n  },\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        1056
      ],
      "id": "087af2f8-22d5-4582-af7b-47a5c318b878",
      "name": "Email Parser AD"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ----- 1) Get the email body from this payload shape -----\nfunction htmlToText(html) {\n  if (!html) return '';\n  // Normalize line breaks before stripping tags\n  html = html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|li|tr|h\\d)>/gi, '\\n')\n    .replace(/&nbsp;/gi, ' ');\n  // Strip tags\n  const text = html.replace(/<[^>]+>/g, ' ');\n  // Collapse whitespace\n  return text.replace(/\\r?\\n/g, '\\n').replace(/[ \\t]+\\n/g, '\\n').replace(/[ \\t]{2,}/g, ' ').trim();\n}\n\nlet emailBody =\n  ($json.text && String($json.text)) ||\n  htmlToText($json.html) ||\n  htmlToText($json.textAsHtml) ||\n  ($json.snippet && String($json.snippet)) ||\n  '';\n\n// If body still empty, try base64-encoded Gmail payload (rare here but safe)\nif (!emailBody && $json.payload && $json.payload.body && $json.payload.body.data) {\n  try {\n    const buff = Buffer.from($json.payload.body.data, 'base64');\n    emailBody = buff.toString('utf8');\n  } catch (_) {}\n}\n\n// Safety: normalize whitespace for robust regex capture\nconst flat = (emailBody || '').replace(/\\r/g, '').replace(/[ \\t]+/g, ' ').trim();\n\n// ----- 2) Robust field capture (works for single-line or multiline) -----\nconst LABELS = [\n  'First Name','Last Name','Employee Number','Job Title',\n  'Department','Manager SAM','Manager','Office Phone','Phone',\n  'Office Location','Location'\n];\n\nfunction esc(s){ return s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); }\n\nfunction captureAfter(label, src) {\n  const labelEsc = esc(label);\n  const next = LABELS.filter(l => l !== label).map(esc);\n  const lookahead = next.length ? `(?=\\\\s*(?:${next.join('|')})\\\\s*:|$)` : '$';\n  // Accept either single-line or multiline values\n  const re = new RegExp(`${labelEsc}\\\\s*:\\\\s*([\\\\s\\\\S]*?)\\\\s*${lookahead}`, 'i');\n  const m = src.match(re);\n  return m ? m[1].trim() : '';\n}\n\nconst userData = {\n  firstname:      captureAfter('First Name', flat),\n  lastname:       captureAfter('Last Name', flat),\n  employeenumber: captureAfter('Employee Number', flat),\n  jobtitle:       captureAfter('Job Title', flat),\n  department:     captureAfter('Department', flat),\n  managersam:     captureAfter('Manager SAM', flat) || captureAfter('Manager', flat),\n  officephone:    captureAfter('Office Phone', flat) || captureAfter('Phone', flat),\n  officelocation: captureAfter('Office Location', flat) || captureAfter('Location', flat),\n};\n\n// ----- 3) Validate required fields -----\nconst required = ['firstname','lastname','employeenumber','jobtitle','department','managersam'];\nconst missing = required.filter(f => !userData[f] || userData[f].trim() === '');\nif (missing.length) {\n  throw new Error(`Missing required fields: ${missing.join(', ')}. Parsed body was empty or labels didn't match exactly.`);\n}\n\n// ----- 4) Subject/From/MessageId from this payload shape -----\nconst subj =\n  $json.subject ||\n  ($json.headers && typeof $json.headers.subject === 'string'\n    ? $json.headers.subject.replace(/^Subject:\\s*/i,'').trim()\n    : '');\n\nconst fromText =\n  ($json.from && $json.from.text) ||\n  ($json.headers && typeof $json.headers.from === 'string'\n    ? $json.headers.from.replace(/^From:\\s*/i,'').trim()\n    : '');\n\nconst msgId =\n  $json.messageId ||\n  ($json.headers && typeof $json.headers['message-id'] === 'string'\n    ? $json.headers['message-id'].replace(/^Message-Id:\\s*/i,'').trim()\n    : '');\n\n// ----- 5) Return in your expected shape -----\nreturn {\n  body: userData,\n  originalEmail: {\n    subject: subj,\n    from: fromText,\n    messageId: msgId,\n  },\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        368
      ],
      "id": "84f2d89b-a952-4f85-9fe3-12e37c554ac8",
      "name": "Email Parser JC"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "if (!$json[\"stdout\"] || $json[\"stdout\"].trim() === \"\") {\n  throw new Error(\"No JSON output received from PowerShell script. Stdout was empty.\");\n}\nlet out;\ntry {\n  out = JSON.parse($json[\"stdout\"]);\n} catch (e) {\n  throw new Error(\"Failed to parse JSON from PowerShell script: \" + e.message + \"\\n\\nOutput was:\\n\" + $json[\"stdout\"]);\n}\nif (out.error) {\n  throw new Error(\"PowerShell script error: \" + out.error);\n}\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        1056
      ],
      "id": "0b96451e-0b9c-4ea4-b284-040b59436c4a",
      "name": "PowerShell Output Parser AD"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "if (!$json[\"stdout\"] || $json[\"stdout\"].trim() === \"\") {\n  throw new Error(\"No JSON output received from PowerShell script. Stdout was empty.\");\n}\nlet out;\ntry {\n  out = JSON.parse($json[\"stdout\"]);\n} catch (e) {\n  throw new Error(\"Failed to parse JSON from PowerShell script: \" + e.message + \"\\n\\nOutput was:\\n\" + $json[\"stdout\"]);\n}\nif (out.error) {\n  throw new Error(\"PowerShell script error: \" + out.error);\n}\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        368
      ],
      "id": "0cf2e617-1b3f-4453-884e-74c9bb18f912",
      "name": "PowerShell Output Parser JC"
    },
    {
      "parameters": {
        "sendTo": "vinokura@alex-it.net",
        "subject": "New AD user Created",
        "message": "=<h1 style=\"color:blue;\">ðŸ¤– New JC User Created:</h1>\n\n<p style=\"color:black; font-size:1.1em;\"><b>First Name:</b> {{$json[\"FirstName\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Last Name:</b> {{$json[\"LastName\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Employee Number:</b> {{$json[\"EmployeeNumber\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Department:</b> {{$json[\"Department\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Job Title:</b> {{$json[\"JobTitle\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Username:</b> {{$json[\"Username\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Manager:</b> {{$json[\"Manager\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Office Location:</b> {{$json[\"OfficeLocation\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Office Phone:</b> {{$json[\"OfficePhone\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>E-mail:</b> {{$json[\"Email\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>DL Groups Copied:</b> {{$json[\"DLGroupsCopied\"].join(', ')}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Security Groups Copied:</b> {{$json[\"SecurityGroupsCopied\"].join(', ')}}</p>\n<p style=\"color:red; font-size:1.3em;\"><b>Initial Password:</b> <code>{{$json[\"Password\"]}}</code></p>\n<p style=\"color:red; font-size:1.1em;\"><b>Make sure to save the initial password in a safe location!</b></p>\n<p style=\"color:green; font-size:1.3em;\"><b>Alex IT</b></p>\n<hr>\n<small>This is an automated message. Do not reply.</small>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1024,
        96
      ],
      "id": "051f0334-8fd0-47c2-b9c8-2d38f45288b4",
      "name": "Send Message JC",
      "webhookId": "961eced4-af4c-4015-a632-1c5dcecb5a5f",
      "executeOnce": false,
      "credentials": {
        "gmailOAuth2": {
          "id": "Ajg1dWYNadbKjzNX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQF_6Wfpg",
          "mode": "list",
          "cachedResultName": "New AD User Created",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQF_6Wfpg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQf_6Wfpg/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "First Name": "={{$json[\"FirstName\"]}}",
            "Last Name": "={{$json[\"LastName\"]}}",
            "Job Title": "={{$json[\"JobTitle\"]}}\n",
            "Password": "={{$json[\"Password\"]}}",
            "Employee Number": "={{$json[\"EmployeeNumber\"]}}",
            "Department": "={{$json[\"Department\"]}}",
            "Manager": "={{$json[\"Manager\"]}}",
            "Office Location": "={{$json[\"OfficeLocation\"]}}",
            "Office Phone": "={{$json[\"OfficePhone\"]}}",
            "Username": "={{$json[\"Username\"]}}",
            "Email": "={{$json[\"Email\"]}}",
            "DL Groups Copied": "={{$json[\"DLGroupsCopied\"].join(', ')}}",
            "Security Groups Copied": "={{$json[\"SecurityGroupsCopied\"].join(', ')}}",
            "Conflict Message": "={{$json[\"ConflictMessage\"]}}",
            "Timestamp": "={{new Date().toLocaleString(\"en-GB\", { hour12: false, timeZone: \"Asia/Jerusalem\" })}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Employee Number",
              "displayName": "Employee Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Job Title",
              "displayName": "Job Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Department",
              "displayName": "Department",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Manager",
              "displayName": "Manager",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Office Location",
              "displayName": "Office Location",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Office Phone",
              "displayName": "Office Phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Username",
              "displayName": "Username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DL Groups Copied",
              "displayName": "DL Groups Copied",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Security Groups Copied",
              "displayName": "Security Groups Copied",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Password",
              "displayName": "Password",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Conflict Message",
              "displayName": "Conflict Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1024,
        272
      ],
      "id": "51a5aba6-c2e3-4af3-b15a-fa73df8a2d29",
      "name": "Append row in sheet JC",
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OtSObLXRdd1pIx61",
          "name": "Google Sheets New User"
        }
      }
    },
    {
      "parameters": {
        "chatId": "426570413",
        "text": "=ðŸ¤– *New JC User Created Successfully!*\n\n*First Name:* {{$json[\"FirstName\"]}}\n*Last Name:* {{$json[\"LastName\"]}}\n*Employee Number:* {{$json[\"EmployeeNumber\"]}}\n*Job Title:* {{$json[\"JobTitle\"]}}\n*Department:* {{$json[\"Department\"]}}\n*Manager:* {{$json[\"Manager\"]}}\n*Office Location:* {{$json[\"OfficeLocation\"]}}\n*Phone:* {{$json[\"OfficePhone\"]}}\n*Email:* {{$json[\"Email\"]}}\n*Username:* {{$json[\"Username\"]}}\n*Password:* `{{$json[\"Password\"]}}`\n{{$json[\"ConflictMessage\"]}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1024,
        464
      ],
      "id": "204ad9e9-53c0-4f1a-8559-3af68b1ee831",
      "name": "Send a text message JC",
      "webhookId": "ae9b49c5-f740-4d7f-b4af-c7ce2935e45f",
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "QH2SVpRQkhmpSDsN",
          "name": "Users Bot"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C099QKJSCTD",
          "mode": "list",
          "cachedResultName": "new-user-created"
        },
        "text": "=ðŸ¤– *New JC User Created Successfully!*\n\n*First Name:* {{$json[\"FirstName\"]}}\n*Last Name:* {{$json[\"LastName\"]}}\n*Employee Number:* {{$json[\"EmployeeNumber\"]}}\n*Job Title:* {{$json[\"JobTitle\"]}}\n*Department:* {{$json[\"Department\"]}}\n*Manager:* {{$json[\"Manager\"]}}\n*Office Location:* {{$json[\"OfficeLocation\"]}}\n*Phone:* {{$json[\"OfficePhone\"]}}\n*Email:* {{$json[\"Email\"]}}\n*Username:* {{$json[\"Username\"]}}\n*Password:* `{{$json[\"Password\"]}}`\n{{$json[\"ConflictMessage\"]}}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1024,
        656
      ],
      "id": "76514e26-eea7-4fc6-a747-7d56cc637e68",
      "name": "Send a message JC",
      "webhookId": "619d4034-0d7d-43f0-9691-ea960aef7115",
      "credentials": {
        "slackApi": {
          "id": "DaNIVrtwfHymDT9P",
          "name": "New User"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "vinokura@alex-it.net",
        "subject": "New AD user Created",
        "message": "=<h1 style=\"color:blue;\">ðŸ¤– New AD User Created:</h1>\n\n<p style=\"color:black; font-size:1.1em;\"><b>First Name:</b> {{$json[\"FirstName\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Last Name:</b> {{$json[\"LastName\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Employee Number:</b> {{$json[\"EmployeeNumber\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Department:</b> {{$json[\"Department\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Job Title:</b> {{$json[\"JobTitle\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Username:</b> {{$json[\"Username\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Manager:</b> {{$json[\"Manager\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Office Location:</b> {{$json[\"OfficeLocation\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Office Phone:</b> {{$json[\"OfficePhone\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>E-mail:</b> {{$json[\"Email\"]}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>DL Groups Copied:</b> {{$json[\"DLGroupsCopied\"].join(', ')}}</p>\n<p style=\"color:black; font-size:1.1em;\"><b>Security Groups Copied:</b> {{$json[\"SecurityGroupsCopied\"].join(', ')}}</p>\n<p style=\"color:red; font-size:1.3em;\"><b>Initial Password:</b> <code>{{$json[\"Password\"]}}</code></p>\n<p style=\"color:red; font-size:1.1em;\"><b>Make sure to save the initial password in a safe location!</b></p>\n<p style=\"color:green; font-size:1.3em;\"><b>Alex IT</b></p>\n<hr>\n<small>This is an automated message. Do not reply.</small>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1040,
        832
      ],
      "id": "a3c03efd-56f0-454d-b38c-ded5fba6c9b2",
      "name": "Send Message AD",
      "webhookId": "961eced4-af4c-4015-a632-1c5dcecb5a5f",
      "executeOnce": false,
      "credentials": {
        "gmailOAuth2": {
          "id": "Ajg1dWYNadbKjzNX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQF_6Wfpg",
          "mode": "list",
          "cachedResultName": "New AD User Created",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQF_6Wfpg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nh_eXCRjrbruYZWqF8_8LvW3TQ_d7EsN3bCQF_6Wfpg/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "First Name": "={{$json[\"FirstName\"]}}",
            "Last Name": "={{$json[\"LastName\"]}}",
            "Job Title": "={{$json[\"JobTitle\"]}}\n",
            "Password": "={{$json[\"Password\"]}}",
            "Employee Number": "={{$json[\"EmployeeNumber\"]}}",
            "Department": "={{$json[\"Department\"]}}",
            "Manager": "={{$json[\"Manager\"]}}",
            "Office Location": "={{$json[\"OfficeLocation\"]}}",
            "Office Phone": "={{$json[\"OfficePhone\"]}}",
            "Username": "={{$json[\"Username\"]}}",
            "Email": "={{$json[\"Email\"]}}",
            "DL Groups Copied": "={{$json[\"DLGroupsCopied\"].join(', ')}}",
            "Security Groups Copied": "={{$json[\"SecurityGroupsCopied\"].join(', ')}}",
            "Conflict Message": "={{$json[\"ConflictMessage\"]}}",
            "Timestamp": "={{new Date().toLocaleString(\"en-GB\", { hour12: false, timeZone: \"Asia/Jerusalem\" })}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Employee Number",
              "displayName": "Employee Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Job Title",
              "displayName": "Job Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Department",
              "displayName": "Department",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Manager",
              "displayName": "Manager",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Office Location",
              "displayName": "Office Location",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Office Phone",
              "displayName": "Office Phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Username",
              "displayName": "Username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DL Groups Copied",
              "displayName": "DL Groups Copied",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Security Groups Copied",
              "displayName": "Security Groups Copied",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Password",
              "displayName": "Password",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Conflict Message",
              "displayName": "Conflict Message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1040,
        1008
      ],
      "id": "b1404adf-0ad3-4f16-b9b1-694681ab82f9",
      "name": "Append row in sheet AD",
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OtSObLXRdd1pIx61",
          "name": "Google Sheets New User"
        }
      }
    },
    {
      "parameters": {
        "chatId": "426570413",
        "text": "=ðŸ¤– *New AD User Created Successfully!*\n\n*First Name:* {{$json[\"FirstName\"]}}\n*Last Name:* {{$json[\"LastName\"]}}\n*Employee Number:* {{$json[\"EmployeeNumber\"]}}\n*Job Title:* {{$json[\"JobTitle\"]}}\n*Department:* {{$json[\"Department\"]}}\n*Manager:* {{$json[\"Manager\"]}}\n*Office Location:* {{$json[\"OfficeLocation\"]}}\n*Phone:* {{$json[\"OfficePhone\"]}}\n*Email:* {{$json[\"Email\"]}}\n*Password:* `{{$json[\"Password\"]}}`\n*DL Groups Copied:* {{$json[\"DLGroupsCopied\"].join(', ')}}\n*Security Groups Copied:* {{$json[\"SecurityGroupsCopied\"].join(', ')}}\n{{$json[\"ConflictMessage\"]}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1040,
        1184
      ],
      "id": "6a756346-fc7e-4346-acf4-df2051df0b0c",
      "name": "Send a text message AD",
      "webhookId": "ae9b49c5-f740-4d7f-b4af-c7ce2935e45f",
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "QH2SVpRQkhmpSDsN",
          "name": "Users Bot"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C099QKJSCTD",
          "mode": "list",
          "cachedResultName": "new-user-created"
        },
        "text": "=ðŸ¤– *New AD User Created Successfully!*\n\n*First Name:* {{$json[\"FirstName\"]}}\n*Last Name:* {{$json[\"LastName\"]}}\n*Employee Number:* {{$json[\"EmployeeNumber\"]}}\n*Job Title:* {{$json[\"JobTitle\"]}}\n*Department:* {{$json[\"Department\"]}}\n*Manager:* {{$json[\"Manager\"]}}\n*Office Location:* {{$json[\"OfficeLocation\"]}}\n*Phone:* {{$json[\"OfficePhone\"]}}\n*Email:* {{$json[\"Email\"]}}\n*Password:* `{{$json[\"Password\"]}}`\n*DL Groups Copied:* {{$json[\"DLGroupsCopied\"].join(', ')}}\n*Security Groups Copied:* {{$json[\"SecurityGroupsCopied\"].join(', ')}}\n{{$json[\"ConflictMessage\"]}}\n",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1040,
        1376
      ],
      "id": "98c13532-1999-473e-9183-b57ca69ff6fb",
      "name": "Send a message AD",
      "webhookId": "619d4034-0d7d-43f0-9691-ea960aef7115",
      "credentials": {
        "slackApi": {
          "id": "DaNIVrtwfHymDT9P",
          "name": "New User"
        }
      }
    }
  ],
  "connections": {
    "Create New JC User": {
      "main": [
        [
          {
            "node": "PowerShell Output Parser JC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Email Parser JC",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Email Parser AD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create New AD User": {
      "main": [
        [
          {
            "node": "PowerShell Output Parser AD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Parser AD": {
      "main": [
        [
          {
            "node": "Send Acknowledgment AD",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create New AD User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Parser JC": {
      "main": [
        [
          {
            "node": "Create New JC User",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Acknowledgment JC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PowerShell Output Parser AD": {
      "main": [
        [
          {
            "node": "Send a message AD",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message AD",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Message AD",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append row in sheet AD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PowerShell Output Parser JC": {
      "main": [
        [
          {
            "node": "Send a message JC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message JC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Message JC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append row in sheet JC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Gmail Trigger": {
      "Gmail Trigger": {
        "lastTimeChecked": 1757150326,
        "possibleDuplicates": [
          "1991e52351b4cc2c",
          "1991de9c8e239e1d"
        ]
      }
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "51c933ac-ffac-4b42-aee8-8396199f2f5a",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-09-02T14:13:13.480Z",
      "updatedAt": "2025-09-02T14:13:13.480Z",
      "role": "workflow:owner",
      "workflowId": "vb6sSMl5XrlcvUae",
      "projectId": "NptNxIUgBjUJaRfd"
    }
  ],
  "tags": []
}